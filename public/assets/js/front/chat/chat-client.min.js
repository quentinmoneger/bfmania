var emojiPopper=$('[data-toggle="emojiPopper"]').emojiPopper({url:"/ajax/load-emoji"});function publishMessages(e){moment.locale("fr");var t=moment(e.createdAt).fromNow();switch(e.users[0].role){case 99:css="black-text";break;case 70:css="red-text";break;case 50:css="indigo-text text-darken-2 ";break;case 30:css="teal-text text-darken-2 ";break;default:css=""}e=`
    <div class=" py-1 px-0 m-0" ><p class="d-flex justify-content-between p-0 m-0 font14"><span class="${css}">${e.users[0].username}</span><small class="py-0 pr-4 ">${t}
    <i type="button" class="fa fa-comment-alt-exclamation px-1" data-toggle="modal" data-report-type="chat" data-username-from="${e.users[0].username}" data-id="${e.id}"  data-target="#report"></i></small></p>
    <p class=" pl-1 py-0  m-0 font12">${e.message}</p>
    `;document.querySelector("#messages").innerHTML+=e;e=document.getElementById("messages");e.scrollTop=e.scrollHeight}window.onload=()=>{const o=io("//localhost:3000");o.on("connect",()=>{o.emit("enter_room","general")}),document.querySelector("#send-chat").addEventListener("submit",e=>{e.preventDefault();var t=document.querySelector("#uuid"),s=document.querySelector("#message-chat"),a=document.querySelector("#tabs li.active").dataset.room,e=new Date;o.emit("chat_message",{uuid:t.value,message:s.value,room:a,createdAt:e}),document.querySelector("#message-chat").value=""}),o.on("received_message",e=>{publishMessages(e)}),document.querySelectorAll("#tabs li").forEach(e=>{e.addEventListener("click",function(){if(!this.classList.contains("active")){const e=document.querySelector("#tabs li.active");e.classList.remove("active"),this.classList.add("active"),document.querySelector("#messages").innerHTML="",o.emit("leave_room",e.dataset.room),o.emit("enter_room",this.dataset.room)}})}),o.on("init_messages",e=>{let t=JSON.parse(e.messages);t!=[]&&t.forEach(e=>{publishMessages(e)})}),document.querySelector("#message-chat").addEventListener("input",()=>{var e=document.querySelector("#uuid").value,t=document.querySelector("#tabs li.active").dataset.room;o.emit("typing",{uuid:e,room:t})})};